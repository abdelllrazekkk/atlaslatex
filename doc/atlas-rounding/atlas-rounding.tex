%-------------------------------------------------------------------------------
% This note documents the ATLAS rounding recommendations.
% It includes rounding with siunit and some example tables.
%-------------------------------------------------------------------------------
\documentclass[UKenglish]{latex/atlasdoc}

% Use biblatex and biber for the bibliography
\usepackage[biblatex,full]{latex/atlaspackage}
\usepackage{scrdate,scrtime}
\usepackage{verbatim}

\usepackage{latex/atlasphysics}

\usepackage{biblatex-num-v2011}
\addbibresource{atlas-rounding.bib}

\graphicspath{{../../logos/}}

% Useful macros for rounding
\newcommand*{\numR}[2]{\num[round-precision=#2]{#1}}
\newcommand*{\numRF}[2]{\num[round-mode=figures,round-precision=#2]{#1}}
\newcommand*{\numRP}[2]{\num[round-mode=places, round-precision=#2]{#1}}
\newcommand{\numpmerr}[3]{\ensuremath{^{\num[round-precision=#3]{#1}}_{\num[round-precision=#3]{#2}}}}
\newcommand{\numpmRF}[3]{\ensuremath{^{\num[round-mode=figures,round-precision=#3]{#1}}_{\num[round-mode=figures,round-precision=#3]{#2}}}}
\newcommand{\numpmRP}[3]{\ensuremath{^{\num[round-mode=places, round-precision=#3]{#1}}_{\num[round-mode=places, round-precision=#3]{#2}}}}

% A couple of useful macros for labelling errors
% \newcommand*{\stat}{\,(\text{stat.})}
% \newcommand*{\syst}{\,(\text{sys.})}

\newcommand*{\pho}{\phantom{0}}
\newcommand*{\phoo}{\phantom{00}}
\newcommand*{\phd}{\phantom{.}}
\newcommand*{\phdo}{\phantom{.0}}
\newcommand*{\phdoo}{\phantom{.00}}
\newcommand*{\dif}{\text{d}}
\newcommand*{\ZB}{\ensuremath{Z}\xspace}
\newcommand*{\ETmiss}{\ensuremath{E_{\text{T}}^{\text{miss}}}\xspace}
\newcommand*{\etajet}{\ensuremath{\eta_{\text{jet}}}\xspace}
\newcommand*{\diffetab}{\ensuremath{\dif\sigma^{b} / \dif\eta^{b}}\xspace}
\newcommand*{\Zgmm}{\ensuremath{Z \to (\mu\mu)}\xspace}
\newcommand*{\Wmn}{\ensuremath{W \to \mu\nu}\xspace}
\newcommand*{\Zgtau}{\ensuremath{Z \to (\tau\tau)}\xspace}
\newcommand*{\db}{\ensuremath{Z \to \mu\um}\xspace}
% \newcommand*{\ttbar}{\ensuremath{t\bar{t}}\xspace}

\newcommand*\Macro[1]{\texttt{\textbackslash#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%           Title page             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \skipbeforetitle{100pt}

% Title
\AtlasTitle{Rounding -- ATLAS Recommendations}

% Author
%\author{The ATLAS Collaboration}

% if multiple authors/affiliations are needed, use the authblk package
\usepackage{authblk}
\renewcommand\Authands{, } % avoid ``. and'' for last author
\renewcommand\Affilfont{\itshape\small} % affiliation formatting


\author[a]{Halina Abramowicz (Tel Aviv)}
\author[a]{Hans Peter Beck (Bern)}
\author[a]{Ian Brock (Bonn)}
\author[a]{Davide Costanzo (Sheffield)}
\author[a]{Anna Di Ciaccio (Roma II)}
\author[a]{Claudia Gemme (Genova)}
\author[a]{Leonid Gladilin (Lomonosov, MSU)}
\author[a]{Masahiro Kuze (Tokyo)}
\author[a]{George Redlinger (BNL)}
\author[a]{Mike Vetterli (SFU/TRIUMF)}
\author[a]{Rik Yoshida (Argonne)}
\author[a]{Dirk Zerwas (Orsay, LAL)}
\author[a]{Dave Charlton (Birmingham)}
\author[a]{Beate Heinemann (LBL)}
\author[a]{Thorsten Wengler (CERN)}
\author[b]{Carlos Escobar}
\author[c]{Tom Le Compte}
\affil[a]{ATLAS Publications Committee}
\affil[b]{University of Pittsburgh}
\affil[c]{Argonne National Lab.}

% Date: if not given, uses current date
\date{\today}

% Draft version: if given, adds draft version on front page, a
% 'DRAFT' box on top of each other page, and line numbers to easy
% commenting. Comment or remove in final version.
%\AtlasVersion{1.0}

\AtlasNote{ATL-COM-GEN-2014-006}

% Journal: adds a
% \journal{Phys.\ Lett.\ B}

% Abstract
\AtlasAbstract{%
  Several conventions for rounding numbers exist and one can almost
  always find reasons why one or the other is to be preferred.  In
  order to minimise the discussion of which convention should be used in
  ATLAS publications, this note summarises the recommendations for
  ATLAS papers. A tool to help with rounding in practice is discussed
  and some example tables are given.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            Content               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%==============================================================================
\section{Executive summary}
\label{sec:summary}

Even though this document is not very long, it is
useful to collect the recommendations into an executive summary.
The PDG rounding rules are given in Section~\ref{sec:recc}. The other
rounding convention that is recommended is referred to here as \enquote{two-digit-uncertainty}
rounding. In this case the uncertainty is always rounded to two
significant digits. The recommendations are:
\begin{itemize}
\item apply common sense in the application of the guidelines;
\item the central value should have a precision that
  matches the uncertainty;
\item for final results quoted in the text of a document, PDG rounding
  rules are preferred. In specific cases, two-digit-uncertainty
  rounding can be applied;
\item in general two-digit-uncertainty rounding should be used in
  tables;
\item for PDG rounding, if statistical and systematic uncertainties are of
similar size and on either side of the boundary for quoting one or two
significant digits, round to two significant digits on the uncertainty;
\item for measurements dominated by either statistical or systematic
  uncertainties, use the larger uncertainty to determine the precision
  with which the result should be given, e.g.\ $\sigma = 160 \pm
  1\stat ^{+21}_{-17}\syst\,\si{\pb}$ (see Sec.\ref{sec:recc:example});
\item in tables of event number yields, the total number of events
  should be evaluated using the full precision available on the numbers,
with all numbers subsequently rounded.
 \end{itemize}


%==============================================================================
\section{Introduction}
\label{sec:intro}

Rounding is a perennial problem and something that can lead to endless
discussions. ATLAS PubCom has therefore decided to provide
a set of recommendations that are accepted within the
collaboration. There are at least three different situations where one
has to consider how rounding should be done:
\begin{itemize}
\item giving results in the text of a paper;
\item tables of event yields, systematic uncertainties, measurements;
\item combining results within or between experiments.
\end{itemize}
For the purpose of this note, it is assumed that a detailed breakdown of
the numbers needed for a combination, is made available
outside of a paper, so that one does not have to worry about the third
case here.

In Sections~\ref{sec:pdg-rounding} and \ref{sec:recc:example},
the recommendations are discussed and some examples are given. Tables are
discussed in Section~\ref{sec:recc:table}.
A tool for semi-automatically rounding numbers, the
\LaTeX\ \textsf{siunitx} package is given in Appendix~\ref{sec:siunitx}. Some
example tables are shown in Appendix~\ref{sec:table}. These are intended to illustrate how typical
tables that appear in publications and notes should be formatted.

Both the \LaTeX\ source file and the final PDF document are
made available, so that authors can use the \LaTeX\ code in
their own document. The explicit recommendations are given in boldface.


%==============================================================================
\section{ATLAS recommendations on rounding}
\label{sec:recc}

\subsection{PDG rounding}
\label{sec:pdg-rounding}

The Particle Data Group~\cite{PDG2012} has a clear description of how
they round numbers:
\begin{quotation}
  While the results shown in the Particle Listings are usually exactly
  those published by the experiments, the numbers that appear in the
  Summary Tables (means, averages and limits) are subject to a set of
  rounding rules. The basic rule states that if the three highest
  order digits of the error lie between 100 and 354, we round to two
  significant digits. If they lie between 355 and 949, we round to one
  significant digit. Finally, if they lie between 950 and 999, we
  round up to 1000 and keep two significant digits. In all cases, the
  central value is given with a precision that matches that of the
  error. So, for example, the result (coming from an average) $0.827
  \pm 0.119$ would appear as $0.83 \pm 0.12$, while $0.827 \pm 0.367$
  would turn into $0.8 \pm 0.4$. Rounding is not performed if a result in a
  Summary Table comes from a single measurement, without any
  averaging. In that case, the number of digits published in the
  original paper is kept, unless we feel it inappropriate. Note that,
  even for a single measurement, when we combine statistical and
  systematic errors in quadrature, rounding rules apply to the result
  of the combination. It should be noted also that most of the limits
  in the Summary Tables come from a single source (the best limit)
  and, therefore, are not subject to rounding.
\end{quotation}

\textbf{For final results quoted in the text of a document, PDG
  rounding rules as given above are preferred.  In specific cases,
  two-digit-uncertainty can be applied instead.}

As will be discussed below, one thing that is missing from this
recommendation is how to deal with uncertainties that are broken down into
statistical and systematic uncertainties, where one uncertainty is on one
side of the boundary, e.g.\ \num{0.34}, and the other is on the other
side, e.g.\ \num{0.36}.

Note that there may well be cases where it is sensible to part with
these guidelines and quote numbers with slightly more or less
precision. This is most commonly the case in tables. Common
sense should be used and it is always important to consider how
well the numbers (and especially the uncertainties) are actually known.
One case where PDG rounding makes more sense than
two-digit-uncertainty is a result like $1.01 \pm 0.98$, where $1.0 \pm 1.0$
is to be preferred.


%------------------------------------------------------------------------------
\subsection{Examples}
\label{sec:recc:example}

In this section some simple, and some not so simple, examples are given:
\begin{itemize}
\item the measured cross-section
  \begin{linenomath}
    \begin{equation*}
      \sigma = 2.63 \pm 0.14\stat \pm 0.18\syst\,\si{\pb}\,;
    \end{equation*}
  \end{linenomath}
  is straightforward and remains unchanged,
\item while the measurement made with a less precise method yields
  \begin{linenomath}
    \begin{equation*}
      \sigma = 2.7 \pm 0.5\stat \pm 0.4\syst\,\si{\pb}\,;
    \end{equation*}
  \end{linenomath}
\item in a third result the two uncertainties straddle the lower rounding boundary
and the result should be written
  \begin{linenomath}
    \begin{equation*}
      \sigma = 2.63 \pm 0.32\stat \pm 0.44\syst\,\si{\pb}.
    \end{equation*}
  \end{linenomath}
Here, one can argue whether one or two
significant digits should be given. \textbf{In such cases, it is recommended
to give two significant digits on the uncertainty.}
\item a fourth result has uncertainties that straddle the upper rounding boundary: it has a statistical
  uncertainty of \num{0.56} and a systematic uncertainty of \num{0.96}. PDG
  rounding rules then require that the result be quoted as
  \begin{linenomath}
    \begin{equation*}
      \sigma = 2.6 \pm 0.6\stat \pm 1.0\syst\,\si{\pb}\,.
    \end{equation*}
  \end{linenomath}
\end{itemize}
In a more extreme case of the third result, a cross-section is
measured to be\\
$160.2 \pm 0.9\stat ^{+20.6}_{-17.1}\syst\,\si{\pb}$.
The relative sizes of statistical and systematic uncertainties given
here are typical for jet cross-sections.
The PDG rounding rules applied to the systematic uncertainty lead to $^{+21}_{-17}$,
and the statistical uncertainty is rounded to 1, not left as 0.9, to be consistent.
\textbf{\boldmath Hence the cross-section should be quoted as 
$160 \pm 1\stat ^{+21}_{-17}\syst\,\si{\pb}$.}

Tables~\ref{tab:real} and \ref{tab:integer} show further examples of
PDG rounding. In these tables the same central value is given,
but the uncertainty varies.

\begin{table}[htbp]
  \begin{minipage}{0.45\textwidth}
  \renewcommand{\arraystretch}{1.2}
  \centering
  \sisetup{retain-explicit-plus=true}
  \begin{tabular}{S@{$\,\pm\,$}S[table-format=1.4] r@{$\,\pm\,$}l}
    \toprule
    \multicolumn{2}{c}{Raw}   &
    \multicolumn{2}{c}{PDG scheme} \\
    \midrule
    0.9441 & 0.119   &
    \numRF{0.9441}{2}       & \pho\numRF{0.119 }{2} \\
    0.9441 & 0.367   &
    \numRF{0.9441}{1}\pho   & \pho\numRF{0.367 }{1} \\
    0.9441 & 0.967   &
    \numRF{0.9441}{1}\pho   & \pho\numRF{0.967 }{1} \\
    0.9441 & 0.0632  &
    \numRF{0.9441}{2}       & \pho\numRF{0.0632}{1} \\
    0.9441 & 1.0632  &
    \numRF{0.9441}{1}\pho   & \pho\numRF{1.0632}{2} \\
    0.9441 & 9.0632  &
    \numRP{0.9441}{0}\phdoo & \pho\numRP{9.0632}{0} \\
    0.9441 & 9.6632  &
    \numRP{0.9441}{0}\phdoo & \numRP{9.6632}{0} \\
    \bottomrule
  \end{tabular}
  \caption{PDG  rounding for real numbers.}
  \label{tab:real}
  \end{minipage}
  \hspace*{0.08\textwidth}
  \begin{minipage}{0.45\textwidth}
  \renewcommand{\arraystretch}{1.2}
  \centering
  \sisetup{retain-explicit-plus=true}
  \begin{tabular}{r@{$\,\pm\,$}r r@{$\,\pm\,$}r r@{$\,\pm\,$}r}
    \toprule
    \multicolumn{2}{c}{Raw}   &
    \multicolumn{2}{c}{PDG scheme} \\
    \midrule
    191819 & 17    &
    \numRF{191819}{6} & \numRF{17}{2}    \\
    191819 & 17891 &
    \numRF{191819}{3} & \numRF{17891}{2} \\
    191819 & 37891 &
    \numRF{191819}{2} & \numRF{37891}{1} \\
    191819 & 97891 &
    \numRF{191819}{2} & \numRF{97891}{1} \\
    \bottomrule
  \end{tabular}
  \caption{PDG rounding examples for integers. The fourth
    line (PDG scheme) is an interpretation of the PDG rules.}
  \label{tab:integer}
  \end{minipage}
\end{table}

In general, it is a good idea
to avoid too many zeroes in the quoted numbers. Hence it is better
to write \num{190 \pm 100E3} than \num{190000 \pm 100000}, or for
numbers with units write \SI{190 \pm 100}{\nb} rather than \SI{190000
  \pm 100000}{\pb}. The ATLAS convention is in fact to write cross-sections
without parentheses, e.g.\ \SI[multi-part-units=single]{190 \pm
  100}{\nb}. In tables, instead of writing \num{190 \pm 100E3},
\num{190 \pm 100} could be used with \enquote{Events / $10^3$} in
the header.

%------------------------------------------------------------------------------
\subsection{Rounding in tables}
\label{sec:recc:table}

Results presented in tables require special consideration.

Tables of event yields often contain numbers that vary by many orders
of magnitude. In addition, while some uncertainties are just Poissonian, the
uncertainty on the multijet background is typically
\SI{50}{\percent}. The size of the uncertainty determined from Monte Carlo
events depends on the number of events that have been
generated. Table~\ref{tab:yield:RAW} is a typical (real) example, where the
raw numbers are shown (no rounding).  Table~\ref{tab:yield:PDG} shows the
result of applying the PDG rules, while two-digit-uncertainty rounding has
been used in Table~\ref{tab:yield:2dig}.  In both cases, the central values
have been rounded to be consistent with the uncertainties. Comparing the
tables side-by-side, either version is acceptable.  

\begin{table}[htbp]
 \centering
  \begin{tabular}{%
      l|
     S@{$\pm\,\,$}S
  }

    \toprule
    & \multicolumn{2}{c}{Selected events}	\\
    \midrule
    $WW, WZ, ZZ$	        & 943.045  & 94.3045 \\
    QCD multijets	        & 2838.39  & 1419.19 \\
    $Wc\bar{c}, Wb\bar{b}, Wc$	& 31178.  & 13094.8 \\
    $W$ + jets	                & 10584.5  & 4445.49 \\
    Single top $Wt$	        & 1699.75  & 152.977 \\
    $Z$ + jets	                & 2378.42  & 998.934 \\
    Single top $s$	        & 297.591  & 12.4988 \\
    Single top $t$	        & 3936.98  & 165.353 \\
    $t\bar{t}$	                & 9386.28  & 901.083 \\
    \midrule
    Expected	                & 63243    & 13968.5 \\
    Data 			& \multicolumn{2}{l}{\ 73062}\\
    \bottomrule
  \end{tabular}
  \caption{Example event yields spread over several orders of
    magnitude: Raw, unrounded, values. See Tables \ref{tab:yield:PDG} and \ref{tab:yield:2dig}
for rounding options.}
  \label{tab:yield:RAW}
  \end{table}

\begin{table}[htbp]
  \sisetup{retain-explicit-plus=true}
  \begin{minipage}{0.45\textwidth}
  \centering
  \begin{tabular}{%
      l|
      r@{$\,\pm\,$}r
    }
    \toprule
    & \multicolumn{2}{c}{Selected events}	\\
    \midrule
    $WW, WZ, ZZ$	        & \numRF{943.045}{2}  & \numRF{94.3045}{1} \\
    QCD multijets	        & \numRF{2838.39}{2}  & \numRF{1419.19}{2} \\
    $Wc\bar{c}, Wb\bar{b}, Wc$	& \numRF{31178  }{2}  & \numRF{13094.8}{2} \\
    $W$ + jets	                & \numRF{10584.5}{2}  & \numRF{4445.49}{1} \\
    Single top $Wt$	        & \numRF{1699.75}{3}  & \numRF{152.977}{2} \\
    $Z$ + jets	                & \numRF{2378.42}{2}  & \numRF{998.934}{1} \\
    Single top $s$	        & \numRF{297.591}{3}  & \numRF{12.4988}{2} \\
    Single top $t$	        & \numRF{3936.98}{3}  & \numRF{165.353}{2} \\
    $t\bar{t}$	                & \numRF{9386.28}{2}  & \numRF{901.083}{1} \\
    \midrule
    Expected	                & \numRF{63243}{2}    & \numRF{13968.5}{2} \\
    Data 			& \multicolumn{2}{l}{\num{73062}}\\
    \bottomrule
  \end{tabular}
  \caption{Example event yields spread over several orders of
    magnitude and rounded according to PDG rules. (Acceptable)}
  \label{tab:yield:PDG}
  \end{minipage}
  \hspace*{0.1\textwidth}
  \begin{minipage}{0.45\textwidth}
  \begin{tabular}{%
      l|
      r@{$\,\pm\,$}r
    }
    \toprule
    & \multicolumn{2}{c}{Selected events}	\\
    \midrule
    $WW, WZ, ZZ$	        & \numRF{943.045}{3}  & \numRF{94.3045}{2} \\
    QCD multijets	        & \numRF{2838.39}{2}  & \numRF{1419.19}{2} \\
    $Wc\bar{c}, Wb\bar{b}, Wc$	& \numRF{31178  }{2}  & \numRF{13094.8}{2} \\
    $W$ + jets	                & \numRF{10584.5}{3}  & \numRF{4445.49}{2} \\
    Single top $Wt$	        & \numRF{1699.75}{3}  & \numRF{152.977}{2} \\
    $Z$ + jets	                & \numRF{2378.42}{2}  & \numRF{998.934}{2} \\
    Single top $s$	        & \numRF{297.591}{3}  & \numRF{12.4988}{2} \\
    Single top $t$	        & \numRF{3936.98}{3}  & \numRF{165.353}{2} \\
    $t\bar{t}$	                & \numRF{9386.28}{3}  & \numRF{901.083}{2} \\
    \midrule
    Expected	                & \numRF{63243}{2}    & \numRF{13968.5}{2} \\
    Data 			& \multicolumn{2}{l}{\num{73062}}\\
    \bottomrule
  \end{tabular}
  \caption{Example event yields spread over several orders of
    magnitude and rounded to 2 significant digits on the error. (Recommended)}
  \label{tab:yield:2dig}
  \end{minipage}
\end{table}

How should the total number of events be evaluated? One can either
round all the numbers and then add them, or use the full
precision available and then round both the
individual numbers and the total. Given that this is what a computer
program does if it computes the total,
\textbf{the recommendation is to evaluate the total
  number of events using the full precision available, and to subsequently round all numbers.
  In this case the sum will always be consistent within the rounding
  uncertainty, although it may not correspond exactly to the sum of the
  rounded numbers.}

A problem taken from a recent ATLAS paper, which a referee
spotted is shown in Table~\ref{tab:yield:zjet}. This illustrates a common
mistake in applying (PDG) rounding rules. The table shows an extract 
from a table in the paper for
the $Z \to \mu\mu$ channel and the column with at least 6
jets. The mistake occurred in column 3, where the rounded
numbers imply that $80 + 17 + 2 = 90$! 
The error here is that the PDG rule was applied in the first line to the 
central value instead of the uncertainty: ($\rm 75.1 \rightarrow 1 \, digit
\rightarrow 80$) instead of ($\rm 16.9 \rightarrow 2 \, digits \rightarrow 75 \pm 17$).
Note that the \Zgtau, diboson and multijet rows have been rounded to only one digit,
in violation of the PDG rules, as the uncertainties on these numbers are \SIrange{50}{100}{\percent}.

\begin{table}[htbp]
  \centering
  \begin{tabular}{l|S@{$\,\pm\,$}S|rr}
    \toprule
    & \multicolumn{2}{c|}{Original values}  & \multicolumn{1}{c}{Rounded} & \multicolumn{1}{c}{Rounded}\\
    & \multicolumn{2}{c|}{\mbox{}}          & \multicolumn{1}{c}{Paper}   & \multicolumn{1}{c}{Correctly} \\
    \midrule
    \Zgmm                          &    75.1  & 16.9 & \numRF{75   }{1}\phdo & \numRF{75.1}{2}\phdo  \\
    \Wmn                           &     0.0  &  0.0 & {$<0.5$}              & \numRF{1}{0}\phdo     \\
    \Zgtau                         &     0.09 &  0.09& \numRP{ 0.09}{1}      & \numRP{ 0.09}{1}      \\
    Diboson                        &     0.41 &  0.21& \numRF{ 0.41}{1}      & \numRF{ 0.41}{1}      \\
    \ttbar,    single top          &    17.2  &  5.0 & \numRF{17.2 }{2}\phdo & \numRF{17.2 }{2}\phdo \\
    Multi-jet                      &     2.09 &  2.18& \numRF{ 2.1 }{1}\phdo & \numRF{ 2.09}{1}\phdo \\
    \midrule
    Total expected                 &    94.92 & 17.76& \numRF{94.8 }{1}\phdo & \numRF{94.92}{2}\phdo \\
    \midrule
    Data (\SI{4.6}{\per\fb})       &   122    & 11   &   122\phdo            &   122\phdo            \\
    \bottomrule
  \end{tabular}
  \caption{Event yields in the 6-jet bin in $Z$ + jets events.}
  \label{tab:yield:zjet}
\end{table}

A second very common use of tables is for a list of systematic
uncertainties. Table~\ref{tab:syst} shows a typical example.
As the numbers of interest are themselves relative uncertainties, PDG
rounding is not applicable.  Table~\ref{tab:systa} rounds to 2
significant digits. Table~\ref{tab:systc} shows the unrounded numbers for reference.
\textbf{It is argued though that Table~\ref{tab:systb} is the optimal
  solution.} All numbers are rounded to one decimal place, except the
large uncertainties such as \enquote{Jet/\ETmiss{}}. With this
solution, minor fractional uncertainties are often rounded to fewer
significant digits than the major ones.

\begin{table}[htbp]
  \centering
  \sisetup{retain-explicit-plus}
 \subfloat[This version keeps two significant digits.]{%
  \begin{tabular}{%
      l
      l@{\,/\,}l
    }
    \toprule
    Source & \multicolumn{2}{c}{$\Delta\sigma/\sigma$ [\si{\percent}]}\\
    \midrule
    Data statistics & \numRF{-3.04}{2}   & \numRF{+3.06}{2}  \\
    Luminosity      & \numRF{-4.3123}{2} & \numRF{+4.7234}{2}\\
    MC statistics   & \numRF{-0.704}{2}  & \numRF{+0.713}{2} \\
    Leptons         & \numRF{-2.487}{2}  & \numRF{+2.586}{2} \\
    Jet/\ETmiss     & \numRF{-9.8264}{2} & \numRF{+10.7932}{2}\\
    $b$-tagging     & \numRF{-0.171}{2}  & \numRF{+0.423}{2} \\
    \ZB + jets      & \numRF{-0.183}{2}  & \numRF{+0.396}{2} \\
    \midrule
    Combined        & \numRF{-11.452}{2}  & \numRF{+12.478}{2} \\
    \bottomrule
  \end{tabular}
  \label{tab:systa}
  }
  \qquad
  \subfloat[This version uses a fixed number (one) of decimal places,
    except for the \enquote{Jet/\ETmiss{}} uncertainty and the
    combined uncertainty. (Recommended)]{%
  \begin{tabular}{%
      l
      l@{\,/\,}l
    }
    \toprule
    Source & \multicolumn{2}{c}{$\Delta\sigma/\sigma$ [\si{\percent}]}\\
    \midrule
    Data statistics & \numRP{-3.04}{1}   & \numRP{+3.06}{1}  \\
    Luminosity      & \numRP{-4.3123}{1} & \numRP{+4.7234}{1}\\
    MC statistics   & \numRP{-0.704}{1}  & \numRP{+0.713}{1} \\
    Leptons         & \numRP{-2.487}{1}  & \numRP{+2.586}{1} \\
    Jet/\ETmiss     & \numRP{-9.8264}{0} & \numRP{+10.7932}{0}\\
    $b$-tagging     & \numRP{-0.171}{1}  & \numRP{+0.423}{1} \\
    \ZB + jets      & \numRP{-0.183}{1}  & \numRP{+0.396}{1} \\
    \midrule
    Combined        & \numRP{-11.452}{0}  & \numRP{+12.478}{0} \\
    \bottomrule
  \end{tabular}
  \label{tab:systb}
  }
 \qquad
  \subfloat[Version with unrounded numbers for reference]{%
  \begin{tabular}{%
      l
      l@{\,/\,}l
    }
    \toprule
    Source & \multicolumn{2}{c}{$\Delta\sigma/\sigma$ [\si{\percent}]}\\
    \midrule
    Data statistics & -3.04   & +3.06 \\
    Luminosity      & -4.3123 & +4.7234\\
    MC statistics   & -0.704  & +0.713 \\
    Leptons         & -2.487  & +2.586 \\
    Jet/\ETmiss     & -9.8264 & +10.7932\\
    $b$-tagging     & -0.171  & +0.423 \\
    \ZB + jets      & -0.183  & +0.396 \\
    \midrule
    Combined        & -11.452  & +12.478 \\
    \bottomrule
  \end{tabular}
  \label{tab:systc}
  }
   \caption{Breakdown of the systematic uncertainties on the
    cross-section measurement.}
\label{tab:syst}
\end{table}

%==============================================================================
\appendix
\section{\textsf{siunitx} -- a tool for rounding}
\label{sec:siunitx}

While rounding can be done by hand, such a procedure is error
prone, especially when dealing with many numbers, and it 
has to be redone every time the numbers change. The
\textsf{siunitx} package~\cite{siunitx} can do the rounding automatically
and provides a number of hooks to steer precisely how this is
done.  It would of course be great to have an option \texttt{round-mode=pdg}, 
but this is not yet available.\footnote{It is not so
  straightforward to come up with a syntax that is universally
  useful. \Macro{num\{4.634(43)\}} is OK. For more complicated cases
  one could consider something like \Macro{sigma} =
  \Macro{numPDG[0.4374]\{6.4348\}\{1\}}, where the optional argument
  gives the relevant (total) error for the rounding and the last
  argument gives the number of digits for the rounding.}  

Note that the syntax used here assumes \textsf{siunitx} version
2. This is integrated into \TeX~Live 2011 and later. In order to use
this version of \LaTeX\ on \texttt{lxplus}, the
appropriate directory must be added to the beginning of the UNIX path:
\begin{verbatim}
  export PATH=/afs/cern.ch/sw/XML/texlive/latest/bin/x86_64-linux:$PATH
\end{verbatim}
Replace \texttt{x86\_64-linux} by \texttt{i386-linux} for 32-bit
machines.

The \Macro{num} macro can be used to round numbers (see the tex file). For numbers with
an associated unit, the macro \Macro{SI} should be used instead.
In the \LaTeX\ code of this note, a few macros are defined that make the
syntax of using \Macro{siunitx} a bit shorter:
\begin{description}
\item[\Macro{numR}] output a number with a given precision using the
  current default rounding mode;
\item[\Macro{numRF}] output a number with a fixed number of significant digits;
\item[\Macro{numRP}] output a number with a fixed number of decimal places;
\item[\Macro{numpmerr}] output an asymmetric uncertainty with a given number
  of significant digits or decimal places, depending on the setting of
  the option \textsf{round-mode};
\item[\Macro{numpmRF}] output an asymmetric uncertainty with a given number
  of significant digits;
\item[\Macro{numpmRP}] output an asymmetric uncertainty with a given number
  of decimal places.
\end{description}


Some example tables are given in the following section. These have
been chosen to show typical (difficult) formatting problems.  Note
that all numbers given in tables in this document have more digits in
the \LaTeX\ file than are shown in the tables. Hence when different
rounding options are used only the options change and not the numbers
themselves.

It takes a while to learn what the different options in
\Macro{siunitx} mean and their consequences. These
examples should cover most problems and at least give ideas as to what is
possible. For more detail see the extensive documentation that comes
with the package.

Tables such as the ones shown in
Table~\ref{tab:rounding:xsect} are very nice, as all numbers except the
one that requires an extra digit are written without any special
formatting! This makes it very easy to create such tables with a
program and then simply copy the numbers into a latex file.

Table~\ref{tab:integer} gives examples with integers. Note that the
macro \Macro{num}, and the related macro \Macro{SI} which is used to
typeset numbers with units, do other nice things like putting a
small space every factor of \num{E3}, e.g.\ the total number of events
after the selection is \num{373844}, while the number predicted by
the background Monte Carlo is
$\numRF{267388}{3} \pm \numRF{24376}{2}$.


%==============================================================================
\section{Example tables}
\label{sec:table}

It requires some effort to get the tables in your document formatted
correctly. In general, integer numbers should be right-aligned and
decimal numbers should be aligned on the decimal point.

If the \textsf{siunitx} package is used, one way to format things is
to use the \enquote{S} format column to get the correct alignment and
also do the rounding. This produces tables whose formatting is
typically \SI{90}{\percent} correct, which is probably OK for internal
notes. This option is most suitable for numbers in tables that are of
similar size. For final publication, standards are somewhat higher and probably
more has to be done by hand. Hence, when it comes to producing a perfect
table, \Macro{num} commands will probably also have to be used.

The \LaTeX\ code for the examples given below can be found in 
Appendix~\ref{sec:raw-data}.

The tables shown earlier in this document were also created with \textsf{siunitx}.
 A few more examples of how to steer the formatting are given here.
Table~\ref{tab:rounding:xsect} compares two different approaches
to how this can be done  in \textsf{siunitx}, even for asymmetric errors.  Note that although these
tables look almost identical, the syntax used to create them is different (see Appendix~\ref{sec:raw-data}).
While the form may appear to be a bit clumsy at first, it is easy enough to get a
program to write out the lines. In the left-hand table
\Macro{numRP} is used in column 3, while the full syntax of \Macro{num} 
in shown in column 4 for illustration purposes only.  The syntax
to change the precision of a single number is shown in the first line of
the left-hand part of the table. This is seen to be rather
trivial, but the alignment on the decimal point is now no longer
perfect. While this is probably OK for internal notes etc., papers
(should) have more stringent requirements. Another way of achieving
the same thing and avoiding the use of \textsf{round-mode} and
\textsf{round-precision} is shown in the code for the right-hand table. Note the
use of options for the \textsf{S} format and the use of \Macro{num} enclosed
in braces to format the row that requires a different precision.

\begin{table}[htbp]
  \centering
  \renewcommand{\arraystretch}{1.4}
  \sisetup{retain-explicit-plus}
  \sisetup{round-mode = places}
  \begin{tabular}{%
      S@{\,:\,}S
      r@{\,}@{$\pm$}@{\,}l@{\,}l
       }
    \toprule
    \multicolumn{2}{c}{\etajet} & \multicolumn{3}{c}{\diffetab} \\
    \multicolumn{2}{c}{} & \multicolumn{3}{c}{[\si{\pico\barn}]} \\
    \midrule
    {\num{-1.6}} & -1.1 & \numRP{0.574}{3} & \num[round-precision=3]{0.094} & $^{\numRP{+0.035}{3}}_{\numRP{-0.031}{3}}$ \\
    {\num{-1.1}} & -0.8 & \numRP{1.213}{2} & \num[round-precision=2]{0.211} & $^{\numRP{+0.162}{2}}_{\numRP{-0.162}{2}}$ \\
    {\num{-0.8}} & -0.5 & \numRP{2.141}{2} & \num[round-precision=2]{0.219} & $^{\numRP{+0.223}{2}}_{\numRP{-0.123}{2}}$ \\
    {\num{-0.5}} & -0.2 & \numRP{2.326}{2} & \num[round-precision=2]{0.210} & $^{\numRP{+0.284}{2}}_{\numRP{-0.214}{2}}$ \\
    {\num{-0.2}} & +0.1 & \numRP{2.641}{2} & \num[round-precision=2]{0.220} & $^{\numRP{+0.283}{2}}_{\numRP{-0.233}{2}}$ \\
    {\num{+0.1}} & +0.5 & \numRP{3.160}{2} & \num[round-precision=2]{0.211} & $^{\numRP{+0.232}{2}}_{\numRP{-0.172}{2}}$ \\
    {\num{+0.5}} & +1.4 & \numRP{2.881}{2} & \num[round-precision=2]{0.154} & $^{\numRP{+0.201}{2}}_{\numRP{-0.301}{2}}$ \\
    \bottomrule
  \end{tabular}
  \quad
  \sisetup{round-mode = places, round-precision = 2}
  \begin{tabular}{%
      S[table-format=3.2, table-number-alignment = right]@{\,:\,}S
      S[round-mode = places, round-precision = 2,
      table-format = 1.3, table-number-alignment = right]
      @{$\,\pm\,$}
      S[round-mode = places, round-precision = 2,
      table-format = 1.3, table-number-alignment = left]
      @{\,}l
       }
    \toprule
    \multicolumn{2}{c}{\etajet} & \multicolumn{3}{c}{\diffetab} \\
    \multicolumn{2}{c}{} & \multicolumn{3}{c}{[\si{\pico\barn}]} \\
    \midrule
    -1.6 & -1.1 & {\numRP{0.574}{3}} & {\numRP{0.094}{3}} & $^{\numRP{+0.035}{3}}_{\numRP{-0.031}{3}}$ \\
    -1.1 & -0.8 & 1.213 & 0.211 & $^{\num{+0.162}}_{\num{-0.162}}$ \\
    -0.8 & -0.5 & 2.141 & 0.219 & $^{\num{+0.223}}_{\num{-0.123}}$ \\
    -0.5 & -0.2 & 2.326 & 0.210 & $^{\num{+0.284}}_{\num{-0.214}}$ \\
    -0.2 & +0.1 & 2.641 & 0.220 & $^{\num{+0.283}}_{\num{-0.233}}$ \\
    +0.1 & +0.5 & 3.160 & 0.211 & $^{\num{+0.232}}_{\num{-0.172}}$ \\
    +0.5 & +1.4 & 2.881 & 0.154 & $^{\num{+0.201}}_{\num{-0.301}}$ \\
    \bottomrule
  \end{tabular}
  \caption{A selection of cross-section measurements. Note that
    for numbers with asymmetric errors, the option 
    \texttt{\Macro{sisetup}\{retain-explicit-plus\}} is used to stop 
    \textsf{siunitx} from dropping the plus signs on the positive
    errors. (although these tables look almost identical, the syntax used to 
    create them is different - see Appendix~\ref{sec:raw-data}).}
  \label{tab:rounding:xsect}
\end{table}

Cross-sections vs.\ $\eta$ are usually not so difficult to
format, as the magnitudes of the numbers do not change much from one
bin to the next. The situation is different for cross-sections as a
function of \ET\ or $x$. Tables~\ref{tab:xsect-ET} and
\ref{tab:xsect-x} show examples of such tables.

\begin{table}[htbp]
  \centering
  \renewcommand{\arraystretch}{1.4}
  \subfloat[No special formatting and
  \texttt{round-mode=figures}. This is the starting point for more
  refined formatting.]{%
    \label{tab:xsect-ET1}%
    \input{cross_sections_charm-ET1}}
  \qquad
  \subfloat[Numbers adjusted according to the recommendations. \texttt{round-mode=places}
  is used for asymmetric errors (except the first row). Some judicious
  use of \Macro{phantom} is applied to get improved, but not yet perfect, alignment.]{%
    \label{tab:xsect-ET2}%
    \input{cross_sections_charm-ET2}}
  \caption{Cross-section vs.\ $E_{T}$.}
  \label{tab:xsect-ET}
\end{table}

\texttt{round-mode=figures} is in general best for cross-sections and
their errors. A precision of 2 digits for the uncertainties is a good
starting point, but will then have to be reduced to 1 digit in some cases. 
For the cross-section values, more digits (typically 3) probably have to
be specified and the precision of some values will again have to be
adjusted by hand. In Table~\ref{tab:xsect-ET2} some of the rounding 
is adjusted by hand so that the numbers conform to the
rules. For the asymmetric errors, \texttt{round-mode=places} is used
and the precision of each asymmetric uncertainty is then set by hand. 
This works well if the cross-sections should all be shown with decimal
points, but does not work if used to round a number such as
\num{182}. Hence the first row uses \texttt{round-mode=figures}. Even
with the tools offered by \Macro{siunitx} getting things exactly right
is non-trivial.

\begin{table}[htb]
  \centering
  \renewcommand{\arraystretch}{1.4}
  \subfloat[No special formatting or rounding. Option
  \textsf{scientific-notation=fixed} used.]{%
    \label{tab:xsect-x1}%
    \input{cross_sections_charm-x1}}
  \qquad
  \subfloat[Several fixes including rescaled cross-section. Quite a
  lot of \Macro{phantom} commands are applied to get alignment correct.]{%
    \label{tab:xsect-x2}%
    \input{cross_sections_charm-x2}}
  \caption{Cross-section vs.\ $x$.}
  \label{tab:xsect-x}
\end{table}

Table~\ref{tab:xsect-x} is probably the most challenging to format
correctly, as the bin boundaries also vary by several orders of
magnitude. Table~\ref{tab:xsect-x1} gives the numbers with the option
\textsf{scientific-notation=fixed} to illustrate the problem of what
the table would look like if the cross-sections are output in
\si{\pb}.  In Table~\ref{tab:xsect-x2}, the exponential format of
numbers is used to rescale the cross-section from \si{\pb} to
\si{\nb}.  \Macro{phantom} had to be used in more places than we
really like in order to get the final alignment
correct. Investigations are ongoing to see if this can be improved.


\section{\LaTeX\ code for tables}
\label{sec:raw-data}

This appendix gives the \LaTeX\ code including the raw data used for 
Tables~\ref{tab:rounding:xsect}, 
\ref{tab:xsect-ET} and \ref{tab:xsect-x}.
These files for Tables~\ref{tab:xsect-ET} and \ref{tab:xsect-x} can also be 
found on \url{http://to-be-defined}.

\subsection{Table~\protect\ref{tab:rounding:xsect}}
\begin{verbatim}
\begin{table}[htbp]
\centering
\renewcommand{\arraystretch}{1.4}
\sisetup{retain-explicit-plus}
\sisetup{round-mode = places}
\begin{tabular}{%
S@{\,:\,}S
r@{\,}@{$\pm$}@{\,}l@{\,}l
}
\toprule
\multicolumn{2}{c}{\etajet} & \multicolumn{3}{c}{\diffetab} \\
\multicolumn{2}{c}{} & \multicolumn{3}{c}{[\si{\pico\barn}]} \\
\midrule
{\num{-1.6}} & -1.1 & \numRP{0.574}{3} & \num[round-precision=3]{0.094} & 
$^{\numRP{+0.035}{3}}_{\numRP{-0.031}{3}}$ \\
{\num{-1.1}} & -0.8 & \numRP{1.213}{2} & \num[round-precision=2]{0.211} & 
$^{\numRP{+0.162}{2}}_{\numRP{-0.162}{2}}$ \\
{\num{-0.8}} & -0.5 & \numRP{2.141}{2} & \num[round-precision=2]{0.219} & 
$^{\numRP{+0.223}{2}}_{\numRP{-0.123}{2}}$ \\
{\num{-0.5}} & -0.2 & \numRP{2.326}{2} & \num[round-precision=2]{0.210} & 
$^{\numRP{+0.284}{2}}_{\numRP{-0.214}{2}}$ \\
{\num{-0.2}} & +0.1 & \numRP{2.641}{2} & \num[round-precision=2]{0.220} & 
$^{\numRP{+0.283}{2}}_{\numRP{-0.233}{2}}$ \\
{\num{+0.1}} & +0.5 & \numRP{3.160}{2} & \num[round-precision=2]{0.211} & 
$^{\numRP{+0.232}{2}}_{\numRP{-0.172}{2}}$ \\
{\num{+0.5}} & +1.4 & \numRP{2.881}{2} & \num[round-precision=2]{0.154} & 
$^{\numRP{+0.201}{2}}_{\numRP{-0.301}{2}}$ \\
\bottomrule
\end{tabular}
%
\quad
%
\sisetup{round-mode = places, round-precision = 2}
\begin{tabular}{%
S[table-format=3.2, table-number-alignment = right]@{\,:\,}S
S[round-mode = places, round-precision = 2,
table-format = 1.3, table-number-alignment = right]
@{$\,\pm\,$}
S[round-mode = places, round-precision = 2,
table-format = 1.3, table-number-alignment = left]
@{\,}l
}
\toprule
\multicolumn{2}{c}{\etajet} & \multicolumn{3}{c}{\diffetab} \\
\multicolumn{2}{c}{} & \multicolumn{3}{c}{[\si{\pico\barn}]} \\
\midrule
-1.6 & -1.1 & {\numRP{0.574}{3}} & {\numRP{0.094}{3}} & 
$^{\numRP{+0.035}{3}}_{\numRP{-0.031}{3}}$ \\
-1.1 & -0.8 & 1.213 & 0.211 & $^{\num{+0.162}}_{\num{-0.162}}$ \\
-0.8 & -0.5 & 2.141 & 0.219 & $^{\num{+0.223}}_{\num{-0.123}}$ \\
-0.5 & -0.2 & 2.326 & 0.210 & $^{\num{+0.284}}_{\num{-0.214}}$ \\
-0.2 & +0.1 & 2.641 & 0.220 & $^{\num{+0.283}}_{\num{-0.233}}$ \\
+0.1 & +0.5 & 3.160 & 0.211 & $^{\num{+0.232}}_{\num{-0.172}}$ \\
+0.5 & +1.4 & 2.881 & 0.154 & $^{\num{+0.201}}_{\num{-0.301}}$ \\
\bottomrule
\end{tabular}
%
\caption{A selection of cross-section measurements! Note the
use of \Macro{sisetup} to keep the plus signs on the positive
errors.}
\label{tab:rounding:xsect}
\end{table}
\end{verbatim}

\subsection{Table~\protect\ref{tab:xsect-ET}}
The files are: \texttt{cross\_sections\_charm-ET1.tex} and 
\texttt{cross\_sections\_charm-ET2.tex}:
{\scriptsize
  \verbatiminput{cross_sections_charm-ET1.tex}
}
{\scriptsize
  \verbatiminput{cross_sections_charm-ET2.tex}
}

\subsection{Table~\protect\ref{tab:xsect-x}}

The files are: \texttt{cross\_sections\_charm-x1.tex} and 
\texttt{cross\_sections\_charm-x2.tex}:
{\scriptsize
  \verbatiminput{cross_sections_charm-x1.tex}
}
{\tiny
  \verbatiminput{cross_sections_charm-x2.tex}
}

%==============================================================================
% Bibliography
% \clearpage
\printbibliography

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
