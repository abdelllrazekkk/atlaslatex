%-------------------------------------------------------------------------------
% This file contains adjustments to the numeric-comp (and numeric)
% biblatex styles that are suggested for ATLAS documents
%
% See ChangeLog or SVN log for history of changes.
% Responsible: Ian Brock (ian.brock@cern.ch)
%-------------------------------------------------------------------------------
\ProvidesPackage{latex/atlasbiblatex}[2014/12/04 v.01-04-02 ATLAS biblatex style]
\NeedsTeXFormat{LaTeX2e}

\typeout{ATLAS biblatex style v.01-04-02}

% Use kvoptions package to set options
\RequirePackage{kvoptions}
\SetupKeyvalOptions{
  family=ABIB,
  prefix=ABIB@
}
\DeclareBoolOption[true]{articletitle}
\DeclareBoolOption[false]{titlequote}
\ProcessKeyvalOptions*

% Turn off title for articles
\ifABIB@articletitle
\else
  \AtEveryBibitem{
    \ifentrytype{article}{\clearfield{title}}{}
    \ifentrytype{booklet}{\clearfield{title}}{}
  }
\fi

% Titles all in italics or in quotes
\ifABIB@titlequote
  \DeclareFieldFormat[article]{title}{\mkbibquote{#1}\isdot}
  \DeclareFieldFormat[booklet]{title}{\mkbibquote{#1}\isdot}
\else
  \DeclareFieldFormat[article]{title}{\emph{#1}\isdot}
  \DeclareFieldFormat[booklet]{title}{\emph{#1}\isdot}
\fi

% Journal in upright font
\DeclareFieldFormat[article]{journaltitle}{#1\isdot}
\DeclareFieldFormat[article]{journalsubtitle}{#1\isdot}

% Change punctuation to comma
\renewcommand*{\newunitpunct}{\addcomma\space}

% You can include the following line(s) if you want to shorten your
% bibliography by not including url fields
% \AtEveryBibitem{\clearfield{url}}
% \AtEveryCitekey{\clearfield{url}}

% Do not add "In:"
\renewbibmacro{in:}{}
% \renewbibmacro{in:}{%
%   \ifentrytype{article}{}{%
%   \printtext{\bibstring{in}\intitlepunct}}}

% Remove p. or pp. by pages - this has to be done for every language
% separately as these strings depend on the language
\renewcommand{\bibpagespunct}{\space}
\DefineBibliographyStrings{UKenglish}{%
  page = {},
  pages = {}
}
\DefineBibliographyStrings{USenglish}{%
  page = {},
  pages = {}
}
\DefineBibliographyStrings{ngerman}{%
  page = {},
  pages = {}
}

% If you get an error here use institution+location+year
% \renewbibmacro*{institution+location+year}{%
\renewbibmacro*{institution+location+date}{%
  % \printlist{location}%
  \iflistundef{institution}
    {\setunit*{\addcomma\space}}
    {\setunit*{\addcolon\space}}%
  \printlist{institution}%
  \setunit*{\addcomma\space}%
  \usebibmacro{date}%
  \newunit}
